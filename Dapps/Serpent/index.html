



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="以太坊中文文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="zh">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.5">
    
    
      
        <title>Serpent - 以太坊文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.bcabdff3.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="indigo" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="以太坊文档" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                以太坊文档
              </span>
              <span class="md-header-nav__topic">
                Serpent
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/wohugb/ethereum-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/ethereum-docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="前言" class="md-tabs__link">
        前言
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Basics/introduction/" title="基础" class="md-tabs__link">
          基础
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Client/cpp-ethereum/" title="客户端" class="md-tabs__link">
          客户端
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Safety/" title="ÐApp开发" class="md-tabs__link md-tabs__link--active">
          ÐApp开发
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Infrastructure/Chain-Spec-Format/" title="基础设施" class="md-tabs__link">
          基础设施
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Research/Proof-of-Stake-FAQ/" title="研究" class="md-tabs__link">
          研究
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../D3VTechnologies/RLP/" title="ÐΞV技术" class="md-tabs__link">
          ÐΞV技术
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Technologies/Patricia-Tree/" title="以太坊技术" class="md-tabs__link">
          以太坊技术
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../EthashDashimoto/" title="挖矿算法" class="md-tabs__link">
          挖矿算法
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Whisper/" title="私语" class="md-tabs__link">
          私语
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Misc/Problems/" title="杂项" class="md-tabs__link">
          杂项
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    以太坊文档
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wohugb/ethereum-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/ethereum-docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../home/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/introduction/" title="介绍" class="md-nav__link">
      介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/Getting-Ether/" title="获取以太币" class="md-nav__link">
      获取以太币
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/dapps/" title="无心应用" class="md-nav__link">
      无心应用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/White-Paper/" title="白皮书" class="md-nav__link">
      白皮书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/Design-Rationale/" title="设计原理" class="md-nav__link">
      设计原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/Yellow-Paper/" title="黄皮书" class="md-nav__link">
      黄皮书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Basics/Releases/" title="发布" class="md-nav__link">
      发布
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      客户端
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        客户端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Client/cpp-ethereum/" title="cpp-ethereum (C++)" class="md-nav__link">
      cpp-ethereum (C++)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Client/ethereumj/" title="ethereumj (Java)" class="md-nav__link">
      ethereumj (Java)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Client/go-ethereum/" title="Geth (Go)" class="md-nav__link">
      Geth (Go)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Client/parity/" title="Parity (Rust)" class="md-nav__link">
      Parity (Rust)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Client/pyethapp/" title="pyethapp (Python)" class="md-nav__link">
      pyethapp (Python)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      ÐApp开发
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        ÐApp开发
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Safety/" title="安全技术" class="md-nav__link">
      安全技术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Resources/" title="开发资源" class="md-nav__link">
      开发资源
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../JavaScript-API/" title="JS API" class="md-nav__link">
      JS API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../JSON-RPC/" title="JSON RPC API" class="md-nav__link">
      JSON RPC API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../solidity/" title="Solidity" class="md-nav__link">
      Solidity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solidity-Features/" title="Solidity 特色" class="md-nav__link">
      Solidity 特色
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solidity-Collections/" title="Solidity 合集" class="md-nav__link">
      Solidity 合集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../solidity-cheatsheet/" title="Solidity 备忘单" class="md-nav__link">
      Solidity 备忘单
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Useful-Ðapp-Patterns/" title="有用的Ðapp模式" class="md-nav__link">
      有用的Ðapp模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Standardized_Contract_APIs/" title="标准化合约接口" class="md-nav__link">
      标准化合约接口
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Using-Meteor/" title="使用Meteor" class="md-nav__link">
      使用Meteor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial/" title="开发指南" class="md-nav__link">
      开发指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Mix-IDE/" title="Mix 指南" class="md-nav__link">
      Mix 指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Mix-Features/" title="Mix 特色" class="md-nav__link">
      Mix 特色
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../viper/" title="Viper" class="md-nav__link">
      Viper
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Serpent
      </label>
    
    <a href="./" title="Serpent" class="md-nav__link md-nav__link--active">
      Serpent
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#differences-between-serpent-and-python" title="Differences Between Serpent and Python" class="md-nav__link">
    Differences Between Serpent and Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorial" title="Tutorial" class="md-nav__link">
    Tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-name-registry" title="Example: Name Registry" class="md-nav__link">
    Example: Name Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#including-files-and-calling-other-contracts" title="Including files, and calling other contracts" class="md-nav__link">
    Including files, and calling other contracts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-data-structures" title="Storage data structures" class="md-nav__link">
    Storage data structures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-arrays-in-memory" title="Simple arrays in memory" class="md-nav__link">
    Simple arrays in memory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arrays-and-functions" title="Arrays and Functions" class="md-nav__link">
    Arrays and Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strings" title="Strings" class="md-nav__link">
    Strings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros" title="Macros" class="md-nav__link">
    Macros
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types" title="Types" class="md-nav__link">
    Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" title="Miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips" title="Tips" class="md-nav__link">
    Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" title="Other" class="md-nav__link">
    Other
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LLL/" title="LLL" class="md-nav__link">
      LLL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mutan/" title="Mutan" class="md-nav__link">
      Mutan
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      基础设施
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        基础设施
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Chain-Spec-Format/" title="链规格格式" class="md-nav__link">
      链规格格式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Inter-exchange-Client-Address-Protocol/" title="互换客户端地址协议" class="md-nav__link">
      互换客户端地址协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/URL-Hint-Protocol/" title="网址提示协议" class="md-nav__link">
      网址提示协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/NatSpec-Determination/" title="国家规定的确定" class="md-nav__link">
      国家规定的确定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Network-Status/" title="网络状态" class="md-nav__link">
      网络状态
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Raspberry-Pi-instructions/" title="树莓派" class="md-nav__link">
      树莓派
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Exchange-Integration/" title="交易一体化" class="md-nav__link">
      交易一体化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Mining/" title="矿业" class="md-nav__link">
      矿业
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Licensing/" title="许可" class="md-nav__link">
      许可
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Infrastructure/Consortium-Chain-Development/" title="联盟链发展" class="md-nav__link">
      联盟链发展
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      研究
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        研究
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Research/Proof-of-Stake-FAQ/" title="权益证明" class="md-nav__link">
      权益证明
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Research/Sharding-FAQ/" title="分片区块链" class="md-nav__link">
      分片区块链
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      ÐΞV技术
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        ÐΞV技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../D3VTechnologies/RLP/" title="RLP 编码" class="md-nav__link">
      RLP 编码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../D3VTechnologies/Node-discovery-protocol/" title="节点发现协议" class="md-nav__link">
      节点发现协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../D3VTechnologies/Wire-Protocol/" title="ÐΞVp2p 有线协议" class="md-nav__link">
      ÐΞVp2p 有线协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../D3VTechnologies/libp2p-Whitepaper/" title="ÐΞVp2p 白皮书" class="md-nav__link">
      ÐΞVp2p 白皮书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../D3VTechnologies/Web3-Secret-Storage-Definition/" title="Web3 秘密存储" class="md-nav__link">
      Web3 秘密存储
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      以太坊技术
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        以太坊技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Patricia-Tree/" title="词树" class="md-nav__link">
      词树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Ethereum-Wire-Protocol/" title="有线协议" class="md-nav__link">
      有线协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Light-client-protocol/" title="轻端协议" class="md-nav__link">
      轻端协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Subtleties/" title="玄机" class="md-nav__link">
      玄机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Solidity/" title="固语言" class="md-nav__link">
      固语言
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Ethereum-Natural-Specification-Format/" title="NatSpec格式" class="md-nav__link">
      NatSpec格式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Ethereum-Contract-ABI/" title="合同ABI" class="md-nav__link">
      合同ABI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Bad-Block-Reporting/" title="坏块报告" class="md-nav__link">
      坏块报告
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Technologies/Bad-Chain-Canary/" title="坏链金丝雀" class="md-nav__link">
      坏链金丝雀
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      挖矿算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        挖矿算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../EthashDashimoto/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../EthashDashimoto/Ethash/" title="Ethash" class="md-nav__link">
      Ethash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../EthashDashimoto/Ethash-C-API/" title="Ethash C API" class="md-nav__link">
      Ethash C API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../EthashDashimoto/Ethash-DAG/" title="Ethash DAG" class="md-nav__link">
      Ethash DAG
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      私语
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        私语
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Whisper/" title="低语提议" class="md-nav__link">
      低语提议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Whisper/Overview/" title="耳语概述" class="md-nav__link">
      耳语概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Whisper/Wire-Protocol/" title="PoC-1 有线协议" class="md-nav__link">
      PoC-1 有线协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Whisper/PoC-2-Wire-Protocol/" title="PoC-2 有线协议" class="md-nav__link">
      PoC-2 有线协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Whisper/PoC-2-Protocol-Spec/" title="PoC-2 白皮书" class="md-nav__link">
      PoC-2 白皮书
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      杂项
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        杂项
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Misc/Problems/" title="加密货币的难题" class="md-nav__link">
      加密货币的难题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Misc/Chain-Fibers-Redux/" title="链条纤维" class="md-nav__link">
      链条纤维
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Misc/Glossary/" title="词汇表" class="md-nav__link">
      词汇表
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#differences-between-serpent-and-python" title="Differences Between Serpent and Python" class="md-nav__link">
    Differences Between Serpent and Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorial" title="Tutorial" class="md-nav__link">
    Tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-name-registry" title="Example: Name Registry" class="md-nav__link">
    Example: Name Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#including-files-and-calling-other-contracts" title="Including files, and calling other contracts" class="md-nav__link">
    Including files, and calling other contracts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-data-structures" title="Storage data structures" class="md-nav__link">
    Storage data structures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-arrays-in-memory" title="Simple arrays in memory" class="md-nav__link">
    Simple arrays in memory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arrays-and-functions" title="Arrays and Functions" class="md-nav__link">
    Arrays and Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strings" title="Strings" class="md-nav__link">
    Strings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros" title="Macros" class="md-nav__link">
    Macros
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types" title="Types" class="md-nav__link">
    Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" title="Miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips" title="Tips" class="md-nav__link">
    Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" title="Other" class="md-nav__link">
    Other
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Serpent</h1>
                
                <p>Serpent is one of the high-level programming languages used to write Ethereum contracts. The language, as suggested by its name, is designed to be very similar to Python; it is intended to be maximally clean and simple, combining many of the efficiency benefits of a low-level language with ease-of-use in programming style, and at the same time adding special domain-specific features for contract programming. The latest version of the Serpent compiler, available <a href="http://github.com/ethereum/serpent">on github</a>, is written in C++, allowing it to be easily included in any client.</p>
<p>This tutorial assumes basic knowledge of how Ethereum works, including the concept of blocks, transactions, contracts and messages and the fact that contracts take a byte array as input and provide a byte array as output. If you do not, then go <a href="https://github.com/ethereum/wiki/wiki/Ethereum-Development-Tutorial">here</a> for a basic tutorial.</p>
<p>This documentation is not complete and these examples may further help:</p>
<p>https://github.com/AugurProject/augur-core/tree/master/tests/serpent_tests</p>
<p>https://github.com/ethereum/serpent/tree/develop/examples</p>
<p>https://github.com/AugurProject/augur-core/tree/master/src</p>
<p>https://github.com/ethereum/dapp-bin</p>
<h3 id="differences-between-serpent-and-python">Differences Between Serpent and Python<a class="headerlink" href="#differences-between-serpent-and-python" title="Permanent link">&para;</a></h3>
<p>The important differences between Serpent and Python are:</p>
<ul>
<li>Python numbers have potentially unlimited size, Serpent numbers wrap around 2<sup>256</sup>. For example, in Serpent the expression <code>3^(2^254)</code> suprisingly evaluates to 1, even though in reality the actual integer is too large to be recorded in its entirety within the universe.</li>
<li>Serpent has no decimals.</li>
<li>Serpent has no list comprehensions (expressions like <code>[x**2 for x in my_list]</code>), dictionaries or most other advanced features</li>
<li>Serpent has no concept of first-class functions. Contracts do have functions, and can call their own functions, but variables (except storage) do not persist across calls.</li>
<li>Serpent has a concept of persistent storage variables (see below)</li>
<li>Serpent has an <code>extern</code> statement used to call functions from other contracts (see below)</li>
</ul>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<p>In order to install the Serpent python library and executable do:</p>
<div class="codehilite"><pre><span></span>$ git clone https://github.com/ethereum/serpent.git
$ <span class="nb">cd</span> serpent
$ git checkout develop
$ make <span class="o">&amp;&amp;</span> sudo make install
$ python setup.py install
</pre></div>


<p>You can install pyethereum itself as well:</p>
<div class="codehilite"><pre><span></span>$ git clone https://github.com/ethereum/pyethereum.git
$ <span class="nb">cd</span> pyethereum
$ git checkout develop
$ pip install -r requirements.txt
$ python setup.py install
</pre></div>


<h3 id="tutorial">Tutorial<a class="headerlink" href="#tutorial" title="Permanent link">&para;</a></h3>
<p>Now, let's write our first contract. Paste the following into a file called <code>mul2.se</code>:</p>
<div class="codehilite"><pre><span></span>def double(x):
    return(x * 2)
</pre></div>


<p>This contract is a simple two lines of code, and defines a function. Functions can be called either by transactions or by other contracts, and are the way that Serpent contracts provide an "interface" to other contracts and to transactions; for example, a contract defining a currency might have functions <code>send(to, value)</code> and <code>check_balance(address)</code>.</p>
<p>Additionally, the Pyethereum testing environment that we will be using simply assumes that data input and output are in this format.</p>
<p>Now, let's try actually compiling the code. Type:</p>
<div class="codehilite"><pre><span></span>$ serpent compile mul2.se
604380600b600039604e567c01000000000000000000000000000000000000000000000000000000006000350463eee9720681141560415760043560405260026040510260605260206060f35b505b6000f3
</pre></div>

<p>And there we go, that's the hexadecimal form of the code that you can put into transactions. Or, if you want to see opcodes:</p>
<div class="codehilite"><pre><span></span>$ serpent pretty_compile mul2.se
<span class="o">[</span>PUSH1, <span class="m">67</span>, DUP1, PUSH1, <span class="m">11</span>, PUSH1, <span class="m">0</span>, CODECOPY, PUSH1, <span class="m">78</span>, JUMP, PUSH29, <span class="m">1</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, <span class="m">0</span>, PUSH1, <span class="m">0</span>, CALLDATALOAD, DIV, PUSH4, <span class="m">238</span>, <span class="m">233</span>, <span class="m">114</span>, <span class="m">6</span>, DUP2, EQ, ISZERO, PUSH1, <span class="m">65</span>, JUMPI, PUSH1, <span class="m">4</span>, CALLDATALOAD, PUSH1, <span class="m">64</span>, MSTORE, PUSH1, <span class="m">2</span>, PUSH1, <span class="m">64</span>, MLOAD, MUL, PUSH1, <span class="m">96</span>, MSTORE, PUSH1, <span class="m">32</span>, PUSH1, <span class="m">96</span>, RETURN, JUMPDEST, POP, JUMPDEST, PUSH1, <span class="m">0</span>, RETURN<span class="o">]</span>
</pre></div>


<p>Alternatively, you can compile to LLL to get an intermediate representation:</p>
<div class="codehilite"><pre><span></span>$ serpent compile_to_lll mul2.se
<span class="o">(</span><span class="k">return</span> <span class="m">0</span>
  <span class="o">(</span>lll
    <span class="o">(</span>with <span class="s1">&#39;__funid</span>
<span class="s1">      (div (calldataload 0)</span>
<span class="s1">        26959946667150639794667015087019630673637144422540572481103610249216</span>
<span class="s1">      )</span>
<span class="s1">      (unless (iszero (eq (get &#39;</span>__funid<span class="o">)</span> <span class="m">4008276486</span><span class="o">))</span>
        <span class="o">(</span>seq
          <span class="o">(</span><span class="nb">set</span> <span class="s1">&#39;x (calldataload 4))</span>
<span class="s1">          (seq</span>
<span class="s1">            (set &#39;</span>_temp_521 <span class="o">(</span>mul <span class="o">(</span>get <span class="s1">&#39;x) 2))</span>
<span class="s1">            (return (ref &#39;</span>_temp_521<span class="o">)</span> <span class="m">32</span><span class="o">)</span>
          <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
    <span class="m">0</span>
  <span class="o">)</span>
<span class="o">)</span>
</pre></div>

<p>This shows you the machinery that is going on inside. As with most contracts, the outermost layer of code exists only to copy the data of the inner code during initialization and return it, since the code returned during initialization is the code that will be executed every time the contract is called; in the EVM you can see this with the <code>CODECOPY</code> opcode, and in LLL this corresponds to the <code>lll</code> meta-operation. Inside of the LLL, we have a wrapper whose purpose it is to grab the first four bytes of the contract data, (that's the <code>(div (calldataload 0) 26959946667150639794667015087019630673637144422540572481103610249216)</code>; we grab four bytes by grabbing the first 32 bytes and dividing it by 2^224) to get the function ID that is being called, and then inside of that we have a series of functions (in this case only one function) that checks the function ID provided against all function IDs supported by the contract. If the function ID is 4008276486, then it sets a variable <code>'x</code> to the message data bytes 4-35 (that's <code>(calldataload 4)</code>), sets a temporary variable to equal to <code>2 * x</code>, and returns the 32 byte memory slice that contains that variable.</p>
<p>The function ID is calculated by computing a hash based on the function name and arguments and taking the first four bytes. In this case we have a function named <code>double</code> with a single integer as an argument; on the command line we can do:</p>
<div class="codehilite"><pre><span></span>$ serpent get_prefix double i
<span class="m">4008276486</span>
</pre></div>


<p>Note that you can have multiple functions with the same name, if they take different combinations of inputs. For instance, a hypothetical function double that takes three integers as input (and, say, returns an array consisting of 2x each one) would have a different prefix:</p>
<div class="codehilite"><pre><span></span>$ serpent get_prefix double iii
<span class="m">1142360101</span>
</pre></div>


<p>The letter <code>i</code> is meant for integers, and for fixed-length (up to 32 byte) strings (which are treated the same as integers in Serpent and EVM). Use the letter <code>s</code> for variable-length string arguments, and <code>a</code> for arrays; more on these later.</p>
<p>Now, what if you want to actually run the contract? That is where <a href="https://github.com/ethereum/pyethereum">pyethereum</a> comes in. Open up a Python console in the same directory, and run:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ethereum.tools</span> <span class="kn">import</span> <span class="n">tester</span> <span class="k">as</span> <span class="n">t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Chain</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;mul2.se&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;serpent&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="mi">84</span>
</pre></div>


<p>The second line initializes a new state (ie. a genesis block). The third line creates a new contract, and creates an object in Python which represents it. You can use <code>x.address</code> to access this contract's address. The fourth line calls the contract with argument 42, and we see 84 predictably come out.</p>
<h3 id="example-name-registry">Example: Name Registry<a class="headerlink" href="#example-name-registry" title="Permanent link">&para;</a></h3>
<p>Having a multiply-by-two function on the blockchain is kind of boring. So let's do something marginally more interesting: a name registry. The main function will be a <code>register(key, value)</code> operation which checks if a given key was already taken, and if is unoccupied then register it with the desired value and return 1; if the key is already occupied return 0. We will also add a second function to check the value associated with a particular key. Let's try it out:</p>
<div class="codehilite"><pre><span></span>def register(key, value):
    # Key not yet claimed
    if not self.storage[key]:
        self.storage[key] = value
        return(1)
    else:
        return(0)  # Key already claimed

def ask(key):
    return(self.storage[key])
</pre></div>


<p>Here, we see a few parts in action. First, we have the <code>key</code> and <code>value</code> variables that the function takes as arguments. The second line is a comment; it does not get compiled and only serves to remind you what the code does. Then, we have a standard if/else clause, which checks if <code>self.storage[key]</code> is zero (ie. unclaimed), and if it is then it sets <code>self.storage[key] = value</code> and returns 1. Otherwise, it returns zero. <code>self.storage</code> is also a pseudo-array, acting like an array but without any particular memory location.</p>
<p>Now, paste the code into <code>namecoin.se</code>, if you wish try compiling it to LLL, opcodes or EVM, and let's try it out in the pyethereum tester environment:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ethereum.tools</span> <span class="kn">import</span> <span class="n">tester</span> <span class="k">as</span> <span class="n">t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Chain</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;namecoin.se&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;serpent&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="mh">0x67656f726765</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="mh">0x67656f726765</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="mi">0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="mh">0x6861727279</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="mh">0x6861727279</span><span class="p">)</span>
<span class="mi">65</span>
</pre></div>


<h3 id="including-files-and-calling-other-contracts">Including files, and calling other contracts<a class="headerlink" href="#including-files-and-calling-other-contracts" title="Permanent link">&para;</a></h3>
<p>Once your projects become larger, you will not want to put everything into the same file; things become particularly inconvenient when one piece of code needs to create a contract. Fortunately, the process for splitting code into multiple files is quite simple. Make the following two files:</p>
<p>mul2.se:</p>
<div class="codehilite"><pre><span></span>def double(x):
    return(x * 2)
</pre></div>


<p>returnten.se:</p>
<div class="codehilite"><pre><span></span>extern mul2.se: [double:[int256]:int256]

MUL2 = create(&#39;mul2.se&#39;)
def returnten():
    return(MUL2.double(5))
</pre></div>


<p>And open Python:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ethereum.tools</span> <span class="kn">import</span> <span class="n">tester</span> <span class="k">as</span> <span class="n">t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Chain</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;returnten.se&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;serpent&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">returnten</span><span class="p">()</span>
<span class="mi">10</span>
</pre></div>


<p>Note that here we introduced several new features. Particularly:</p>
<ul>
<li>The <code>create</code> command to create a contract using code from another file</li>
<li>The <code>extern</code> keyword to declare a class of contract for which we know the names of the functions</li>
<li>The interface for calling other contracts</li>
</ul>
<p><code>create</code> is self-explanatory; it creates a contract and returns the address to the contract.</p>
<p>The way <code>extern</code> works is that you declare a class of contract, in this case <code>mul2</code>, and then list in an array the names of the functions, in this case just <code>double</code>. To generate <code>extern mul2.se: [double:[int256]:int256]</code> use</p>
<div class="codehilite"><pre><span></span>$ serpent mk_signature mul2.se
</pre></div>


<p>From there, given any variable containing an address, you can do <code>x.double(arg1)</code> to call the address stored by that variable. The arguments are the values provided to the function. If you provide too few arguments, the rest are filled to zero, and if you provide too many the extra ones are ignored. Function calling also has some other optional arguments:</p>
<ul>
<li><code>gas=12414</code> - call the function with 12414 gas instead of the default (all gas)</li>
<li><code>value=10^19</code> - send 10^19 wei (10 ether) along with the message</li>
<li><code>data=x</code>, <code>datasz=5</code> - call the function with 5 values from the array <code>x</code>; note that this replaces other function arguments. <code>data</code> without <code>datasz</code> is illegal</li>
<li><code>outsz=7</code> - by default, Serpent processes the output of a function by taking the first 32 bytes and returning it as a value. However, if <code>outsz</code> is used as here, the function will instead return an array containing 7 values; if you type <code>y = x.fun(arg1, outsz=7)</code> then you will be able to access the output via <code>y[0]</code>, <code>y[1]</code>, etc.</li>
</ul>
<p>Another similar operation to <code>create</code> is <code>inset('filename')</code>, which simply puts code into a particular place without adding a separate contract.</p>
<p>returnten.se</p>
<div class="codehilite"><pre><span></span>inset(&#39;mul2.se&#39;)

def returnten():
    return(self.double(5))
</pre></div>


<h3 id="storage-data-structures">Storage data structures<a class="headerlink" href="#storage-data-structures" title="Permanent link">&para;</a></h3>
<p>In more complicated contracts, you will often want to store data structures in storage to represent certain objects. For example, you might have a decentralized exchange contract that stores the balances of users in multiple currencies, as well as open bid and ask orders where each order has a price and a quantity. For this, Serpent has a built-in mechanism for defining your own structures. For example, in such a decentralized exchange contract you might see:</p>
<div class="codehilite"><pre><span></span>data user_balances[][]
data orders[](buys[](user, price, quantity), sells[](user, price, quantity))
</pre></div>


<p>Then, you might do something like:</p>
<div class="codehilite"><pre><span></span>def fill_buy_order(currency, order_id):
    # Available amount buyer is willing to buy
    q = self.orders[currency].buys[order_id].quantity
    # My balance in the currency
    bal = self.user_balances[msg.sender][currency]
    # The buyer
    buyer = self.orders[currency].buys[order_id].user
    if q &gt; 0:
        # The amount we can actually trade
        amount = min(q, bal)
        # Trade the currency against the base currency
        self.user_balances[msg.sender][currency] -= amount
        self.user_balances[buyer][currency] += amount
        self.user_balances[msg.sender][0] += amount * self.orders[currency].buys[order_id].price
        self.user_balances[buyer][0] -= amount * self.orders[currency].buys[order_id].price
        # Reduce the remaining quantity on the order
        self.orders[currency].buys[order_id].quantity -= amount
</pre></div>


<p>Notice how we define the data structures at the top, and then use them throughout the contract. These data structure gets and sets are converted into storage accesses in the background, so the data structures are persistent.</p>
<p>The language for doing data structures is simple. First, we can do simple variables:</p>
<div class="codehilite"><pre><span></span>data blah

x = self.blah
self.blah = x + 1
</pre></div>


<p>Then, we can do arrays, both finite and infinite:</p>
<div class="codehilite"><pre><span></span>data blah[1243]
data blaz[]

x = self.blah[505]
y = self.blaz[3**160]
self.blah[125] = x + y
</pre></div>


<p>Note that finite arrays are always preferred, because it will cost less gas to calculate the storage index associated with a finite array index lookup. And we can do tuples, where each element of the tuple is itself a valid data structure:</p>
<div class="codehilite"><pre><span></span>data body(head(eyes[2], nose, mouth), arms[2], legs[2])

x = self.body.head.nose
y = self.body.arms[1]
</pre></div>


<p>And we can do arrays of tuples:</p>
<div class="codehilite"><pre><span></span>data bodies[100](head(eyes[2], nose, mouth), arms[2](fingers[5], elbow), legs[2])

x = self.bodies[45].head.eyes[1]
y = self.bodies[x].arms[1].fingers[3]
</pre></div>


<p>Note that the following is unfortunately not legal:</p>
<div class="codehilite"><pre><span></span>data body(head(eyes[2], nose, mouth), arms[2], legs[2])

x = self.body.head
y = x.eyes[0]
</pre></div>


<p>Accesses have to descend fully in a single statement. To see how this could be used in a simpler example, let's go back to our name registry, and upgrade it so that when a user registers a key they become the owner of that key, and the owner of a key has the ability to (1) transfer ownership, and (2) change the value. We'll remove the return values here for simplicity.</p>
<div class="codehilite"><pre><span></span>data registry[](owner, value)

def register(key):
    # Key not yet claimed
    if not self.registry[key].owner:
        self.registry[key].owner = msg.sender

def transfer_ownership(key, new_owner):
    if self.registry[key].owner == msg.sender:
        self.registry[key].owner = new_owner

def set_value(key, new_value):
    if self.registry[key].owner == msg.sender:
        self.registry[key].value = new_value

def ask(key):
    return([self.registry[key].owner, self.registry[key].value], items=2)
</pre></div>


<p>Note that in the last ask command, the function returns an array of 2 values. If you wanted to call the registry, you would have needed to do something like <code>o = registry.ask(key, outsz=2)</code> and you could have then used <code>o[0]</code> and <code>o[1]</code> to recover the owner and value.</p>
<h3 id="simple-arrays-in-memory">Simple arrays in memory<a class="headerlink" href="#simple-arrays-in-memory" title="Permanent link">&para;</a></h3>
<p>The syntax for arrays in memory are different: they can only be finite and cannot have tuples or more complicated structures.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span>def bitwise_or(x, y):
    blah = array(1243)
    blah[567] = x
    blah[568] = y
    blah[569] = blah[567] | blah[568]
    return(blah[569])
</pre></div>


<p>There are also two functions for dealing with arrays:</p>
<div class="codehilite"><pre><span></span>len(x)
</pre></div>


<p>Returns the length of array x.</p>
<div class="codehilite"><pre><span></span>slice(x, items=start, items=end)
</pre></div>


<p>Takes a slice of x starting with position start and ending with position end (note that we require <code>end &gt;= start</code>; otherwise the result will almost certainly result in an error)</p>
<h3 id="arrays-and-functions">Arrays and Functions<a class="headerlink" href="#arrays-and-functions" title="Permanent link">&para;</a></h3>
<p>Functions can also take arrays as arguments, and return arrays.</p>
<div class="codehilite"><pre><span></span>def compose(inputs:arr):
    return(inputs[0] + inputs[1] * 10 + inputs[2] * 100)

def decompose(x):
    return([x % 10, (x % 100) / 10, x / 100]:arr)
</pre></div>


<p>Putting the <code>:arr</code> after a function argument means it is an array, and putting it inside a return statement returns the value as an array (just doing <code>return([x,y,z])</code> would return the integer which is the memory location of the array).</p>
<p>If a contract calls one of its functions, then it will autodetect which arguments should be arrays and parse them accordingly, so this works fine:</p>
<div class="codehilite"><pre><span></span>def compose(inputs:arr, radix):
    return(inputs[0] + inputs[1] * radix + inputs[1] * radix ** 2)

def main():
    return self.compose([1,2,3,4,5], 100)
</pre></div>


<p>However, if a contract wants to call another contract that takes arrays as arguments, then you will need to put a "signature" into the extern declaration:</p>
<div class="codehilite"><pre><span></span>extern composer: [compose:[int256[],int256]:int256, main:[]:int256]
</pre></div>


<p>If you want to determine the signature to use from a given file, you can do:</p>
<div class="codehilite"><pre><span></span>&gt; serpent mk_signature compose_test.se
extern compose_test: [compose:[int256[],int256]:int256, main:[]:int256]
</pre></div>


<h3 id="strings">Strings<a class="headerlink" href="#strings" title="Permanent link">&para;</a></h3>
<p>There are two types of strings in Serpent: short strings, eg. <code>"george"</code>, and long strings, eg. <code>text("afjqwhruqwhurhqkwrhguqwhrkuqwrkqwhwhrugquwrguwegtwetwet")</code>. Short strings, given simply in quotes as above, are treated as numbers; long strings, surrounded by the <code>text</code> keyword as above, are treated as array-like objects; you can do <code>getch(str, index)</code> and <code>setch(str, index)</code> to manipulate characters in strings (doing <code>str[0]</code> will treat the string as an array and try to fetch the first 32 characters as a number).</p>
<p>To use strings as function arguments or outputs, use the <code>str</code> tag, much like you would use <code>arr</code> for arrays. <code>len(s)</code> gives you the length of a string, and <code>slice</code> works for strings the same way as for arrays too.</p>
<p>Here is an example of returning/retrieving a string:
<div class="codehilite"><pre><span></span>data str

def t2():
    self.str = text(&quot;01&quot;)
    log(data=self.str)
    return(self.str, chars=2)

def runThis():
    s = self.t2(outsz=2)
    log(data=s)
</pre></div></p>
<h3 id="macros">Macros<a class="headerlink" href="#macros" title="Permanent link">&para;</a></h3>
<p><strong>WARNING: Relatively new/untested feature, here be ~~dragons~~ serpents</strong></p>
<p>Macros allow you to create rewrite rules which provide additional expressivity to the language. For example, suppose that you wanted to create a command that would compute the median of three values. You could simply do:</p>
<div class="codehilite"><pre><span></span>macro median($a, $b, $c):
    min(min(max($a, $b), max($a, $c)), max($b, $c))
</pre></div>


<p>Then, if you wanted to use it somewhere in your code, you just do:</p>
<div class="codehilite"><pre><span></span>x = median(5, 9, 7)
</pre></div>


<p>Or to take the max of an array:</p>
<div class="codehilite"><pre><span></span>macro maxarray($a:$asz):
    $m = 0
    $i = 0
    while i &lt; $asz:
        $m = max($m, $a[i])
        $i += 1
    $m

x = maxarray([1, 9, 5, 6, 2, 4]:6)
</pre></div>


<p>For a highly contrived example of just how powerful macros can be, see https://github.com/ethereum/serpent/blob/poc7/examples/peano.se</p>
<p>Note that macros are not functions; they are copied into code every time they are used. Hence, if you have a long macro, you may instead want to make the macro call an actual function. Additionally, note that the dollar signs on variables are important; if you omit a dollar sign in the pattern $a then the macro will only match a variable actually called a. You can also create dollar sign variables that are in the substitution pattern, but not the search pattern; this will generate a variable with a random prefix each instance of the macro. You can also create new variables without a dollar sign inside a substitution pattern, but then the same variable will be shared across all instances of the pattern and with uses of that variable outside the pattern.</p>
<h3 id="types">Types<a class="headerlink" href="#types" title="Permanent link">&para;</a></h3>
<p><strong>WARNING: Relatively new/untested feature, here be ~~dragons~~ serpents</strong></p>
<p>An excellent compliment to macros is Serpent's ghetto type system, which can be combined with macros to produce quite interesting results. Let us simply show this with an example:</p>
<div class="codehilite"><pre><span></span>type float: [a, b, c]

macro float($x) + float($y):
    float($x + $y)

macro float($x) - float($y):
    float($x - $y)

macro float($x) * float($y):
    float($x * $y / 2^32)

macro float($x) / float($y):
    float($x * 2^32 / $y)

macro unfloat($x):
    $x / 2^32

macro floatfy($x):
    float($x * 2^32)

macro float($x) = float($y):
    $x = $y

macro with(float($x), float($y), $z):
    with($x, $y, $z)

a = floatfy(25)
b = a / floatfy(2)
c = b * b
return(unfloat(c))
</pre></div>


<p>This returns 156, the integer portion of 12.5^2. A purely integer-based version of this code would have simply returned 144. An interesting use case would be rewriting the <a href="https://github.com/ethereum/serpent/blob/df0aa0e1285d7667d4a0cc81b1e11e0abb31fff3/examples/ecc/jacobian_add.se">elliptic curve signature pubkey recovery code</a> using types in order to make the code neater by making all additions and multiplications implicitly modulo P, or using <a href="https://github.com/ethereum/serpent/blob/poc7/examples/long_integer_macros.se">long integer types</a> to do RSA and other large-value-based cryptography in EVM code.</p>
<h3 id="miscellaneous">Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permanent link">&para;</a></h3>
<p>The three other useful features in the tester environment are:</p>
<ul>
<li>Block access - you can dig around <code>s.block</code> to see block data (eg. <code>s.block.number</code>, <code>s.block.get_balance(addr)</code>, <code>s.block.get_storage_data(addr, index)</code>)</li>
<li>Snapshots - you can do <code>x = s.snapshot()</code> and <code>s.revert(x)</code></li>
<li>Advancing blocks - you can do <code>s.mine(100)</code> and 100 blocks magically pass by with a 60-second interval between blocks. <code>s.mine(100, addr)</code> mines into a particular address.</li>
<li>Full block data dump - type <code>s.block.to_dict()</code></li>
</ul>
<p>Serpent also gives you access to many "special variables"; the full list is:</p>
<ul>
<li><code>tx.origin</code> - the sender of the transaction</li>
<li><code>tx.gasprice</code> - gas price of the transaction</li>
<li><code>msg.gas</code> - estimated gas by sender</li>
<li><code>msg.sender</code> - the sender of the message</li>
<li><code>msg.value</code> - the number of wei (smallest units of ether) sent with the message</li>
<li><code>self</code> - the contract's own address</li>
<li><code>self.balance</code> - the contract's balance</li>
<li><code>x.balance</code> (for any x) - that account's balance</li>
<li><code>block.coinbase</code> - current block miner's address</li>
<li><code>block.timestamp</code> - current block timestamp</li>
<li><code>block.prevhash</code> - previous block hash</li>
<li><code>block.difficulty</code> - current block difficulty</li>
<li><code>block.number</code> - current block number</li>
<li><code>block.gaslimit</code> - current block gaslimit</li>
</ul>
<p>Serpent recognises the following "special functions":</p>
<ul>
<li><code>def init():</code> - executed upon contract creation, accepts no parameters</li>
<li><code>def shared():</code> - executed before running <code>init</code> and user functions</li>
<li><code>def any():</code> - executed before any user functions</li>
</ul>
<p>There are also special commands for a few crypto operations; particularly:</p>
<ul>
<li><code>addr = ecrecover(h, v, r, s)</code> - determines the address that produced the elliptic curve signature <code>v, r, s</code> of the hash <code>h</code></li>
<li><code>x = sha256(a, items=4)</code> - returns the sha256 hash of the 128 bytes consisting of the 4-item array starting from <code>a</code></li>
<li><code>x = ripemd160(a, items=4)</code> - same as above but for ripemd160</li>
<li>To hash an arbitrary number of bytes, use chars syntax.  Example: <code>x = sha256([0xf1fc122bc7f5d74df2b9441a42a1469500000000000000000000000000000000], chars=16)</code> - returns the sha256 of the first 16 bytes.  Note: padding with trailing zeroes, otherwise the first 16 bytes will be zeroes, and the sha256 of it will be computed instead of the desired.</li>
<li>you can also use sha3 instead of sha256, e.g. <code>sha3(a, items=4)</code></li>
</ul>
<h3 id="tips">Tips<a class="headerlink" href="#tips" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>If a function is not returning the result you expect, double-check that all variables are correct: there is no error/warning when using an undeclared variable.</p>
</li>
<li>
<p><code>Invalid argument count or LLL function</code> usually means you just called foo() instead of <code>self.foo()</code>.</p>
</li>
<li>
<p>Sometimes you may be intending to use unsigned operators. eg div() and lt() instead of '/' and '&lt;'.</p>
</li>
<li>
<p>To upgrade Serpent, you may need to do <code>pip uninstall ethereum-serpent</code> and <code>python setup.py install</code>. (Avoid <code>pip install ethereum-serpent</code> since it will get from PyPI which is probably old.) (Also avoid using the master branch, which is probably even older than the PyPI version; use the develop branch instead.)</p>
</li>
<li>
<p>When calling abi_contract(), if you get this type of error <code>Exception: Error (file "main", line 1, char 5): Invalid object member (ie. a foo.bar not mapped to anything)</code> make sure you are specifying correct path to the file you are compiling.</p>
</li>
<li>
<p>If you get a core dump when calling <code>abi_contract()</code>, check that you do not have functions with the same name.</p>
</li>
<li>
<p>Use macro for constants, example:
<div class="codehilite"><pre><span></span>macro CONSTANT: 99
</pre></div></p>
</li>
<li>
<p>Be careful that if your flow requires going through a number of contracts, that someone can't just directly short-circuit and call one of your latter contracts with data they've manipulated elsewhere. Example: If you have contract C which gives someone ether, but relies on computation from Contract A-&gt;B-&gt;C, that someone can't just call B or C to give themselves ether.</p>
</li>
</ul>
<h3 id="other">Other<a class="headerlink" href="#other" title="Permanent link">&para;</a></h3>
<p>http://mc2-umd.github.io/ethereumlab/docs/serpent_tutorial.pdf - some outdated but can generally be helpful</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../viper/" title="Viper" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                Viper
              </span>
            </div>
          </a>
        
        
          <a href="../LLL/" title="LLL" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                LLL
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            版权 &copy; 2018 -  wohugb.github.io
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              <script src="../../assets/javascripts/lunr/lunr.zh.js"></script>
            
          
          
        
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>